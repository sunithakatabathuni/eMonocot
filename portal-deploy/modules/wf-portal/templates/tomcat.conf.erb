ErrorDocument 503 /error/503.html
ErrorDocument 404 /error/404.html

FileETag MTime Size
<IfModule mod_rewrite.c>
	RewriteEngine On
	RewriteCond %{HTTP_USER_AGENT} (googlebot) [NC]
	ReWriteRule ^(.*);jsessionid=[A-Za-z0-9\.\-]+(.*)$ $1$2 [L,R=301]
	<% @static_dirs.each do |static_dir| -%>
	RewriteRule ^/(<%= static_dir %>.+);jsessionid=[\w\.\-]+$ /$1
	<% end -%>
	RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} !-f
	RewriteRule ^/images/(fullsize|thumbnails)/[^.]+\.(jpg|gif|png|bmp)$ /css/images/404_$1.jpg [L]
</IfModule>

<IfModule deflate_module>
	AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript
</IfModule>

<IfModule expires_module>
	ExpiresByType text/html "now"
	<Filesmatch "\.(jpg|gif|jpeg|ico|swf|png|css|js|eot|svg|ttf|woff)$">
		ExpiresActive on
		ExpiresDefault "access plus 1 year"
	</Filesmatch>
</IfModule>

<IfModule headers_module>
	Header set Cache-Control "max-age=0, must-revalidate, proxy-revalidate"
	<Filesmatch "\.(jpg|gif|jpeg|ico|swf|png|css|js|eot|svg|ttf|woff)$">
		Header set Cache-Control "max-age=31536000, must-revalidate, proxy-revalidate"
	</Filesmatch>
</IfModule>

<IfModule mod_proxy.c>
	ProxyRequests Off
	ProxyPreserveHost On

	ProxyPass /error !
	ProxyPass /robots.txt !

<% @static_dirs.each do |static_dir| -%>
	ProxyPass /<%= static_dir %> !
<% end -%>

	ProxyPass /geoserver ajp://<%= @geo_server %>:8009/geoserver
	ProxyPassReverse /geoserver ajp://<%= @geo_server %>:8009/geoserver

	ProxyPass / ajp://<%= @tomcat_server %>/
	ProxyPassReverse / ajp://<%= @tomcat_server %>/
</IfModule>
